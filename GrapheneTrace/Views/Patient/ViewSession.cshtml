@using GrapheneTrace.Models
@{
    ViewData["Title"] = "Session Viewer";
    var session = ViewBag.Session as SensorSession;
    var frame = ViewBag.CurrentFrame as SensorFrame;
    var comments = ViewBag.Comments as List<Comment>;
    int currentIndex = ViewBag.CurrentFrameIndex;
    int totalFrames = ViewBag.TotalFrames;
}

<h2>Session @session.SessionID</h2>
<p>Started: @session.StartTime</p>

@if (frame == null)
{
    <div class="alert alert-warning">No frames available for this session.</div>
}
else
{
    <div class="row">
        <div class="col-md-8">
            <h4>Current Pressure Heatmap (Frame @currentIndex of @totalFrames)</h4>

            <!-- Plug your existing heatmap UI here.
                 Use frame data (e.g. frame.Data, Width/Height) exactly
                 like you already do for the Raffay screenshot. -->
        </div>

        <div class="col-md-4">
            <h4>Your Notes &amp; Comments</h4>

            @if (TempData["CommentError"] != null)
            {
                <div class="alert alert-danger">@TempData["CommentError"]</div>
            }
            @if (TempData["CommentSuccess"] != null)
            {
                <div class="alert alert-success">@TempData["CommentSuccess"]</div>
            }

            <form asp-action="AddComment" method="post">
                <input type="hidden" name="sessionId" value="@session.SessionID" />
                <input type="hidden" name="frameId" value="@frame.FrameID" />
                <input type="hidden" name="currentFrameIndex" value="@currentIndex" />

                <div class="mb-2">
                    <textarea name="content" class="form-control" rows="3"
                          placeholder="Describe any discomfort, posture, or pressure areas..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Save Note</button>
            </form>

            <hr />
            <h5>Previous Notes</h5>

            @if (comments == null || !comments.Any())
            {
                <p>No notes yet for this session.</p>
            }
            else
            {
                foreach (var c in comments)
                {
                    <div class="card mb-2">
                        <div class="card-body">
                            <small class="text-muted">@c.CreatedAt</small>
                            <p>@c.Content</p>
                        </div>
                    </div>
                }
            }
        </div>
    </div>

    <hr />

    <div>
        @if (currentIndex > 0)
        {
            <a asp-action="ViewSession"
               asp-route-sessionId="@session.SessionID"
               asp-route-frameIndex="@(currentIndex - 1)"
               class="btn btn-secondary">Previous Frame</a>
        }

        @if (currentIndex < totalFrames - 1)
        {
            <a asp-action="ViewSession"
               asp-route-sessionId="@session.SessionID"
               asp-route-frameIndex="@(currentIndex + 1)"
               class="btn btn-secondary">Next Frame</a>
        }
    </div>
}
